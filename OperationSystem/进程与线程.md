# 进程与线程

操作系统中最核心的概念是*进程*：对正在运行程序的一个抽象。操作系统的其他所有内容都是围绕着进程的概念展开的。

伪并行：在1秒钟内，它可能运行多道程序，这样给用户一种并行的错觉。

并行：对于多核CPU而言，可以在同一时刻运行多道程序。

## 进程

在进程模型中，计算机上所有可运行的软件，通常包括操作系统，被组织程若干顺序进程（sequential process），简称进程（process）。一个进程就是正在执行的程序，包括程序计数器，寄存器和变量的当前值。从概念上将，每个进程都有自己的虚拟CPU，实际上，真正的CPU在各进程之间来回切换。这种快速切换称为**多道程序设计**。



一个进程是某个类型的一个活动，它有程序、输入、输出以及状态。单个处理机可以被若干进程共享，它使用某种调度算法决定何时停止一个进程的工作。

### 进程的创建

有四种原因导致创建进程：

1. 系统初始化
2. 执行了从事创建进程的系统调用
3. 用户请求创建进程
4. 一个批处理作业的初始化

Unix系统，只能由一个系统调用来创建新进程**fork**。

### 进程的终止

由四种原因导致进程终止

1. 正常退出（自愿）
2. 出错退出（自愿）
3. 严重错误
4. 被其它进程杀死



进程层次结构是一种树结构，可有单个进程产生多个进程实体

### 进程的状态

1. 运行态（该时刻进程实际占用CPU）
2. 就绪态（可运行，但因为其他进程正在运行而暂时停止）
3. 阻塞态（除非某种外部事件发生，否则进程不能运行）



### 进程的实现

为了实现进程模型，操作系统维护者一张表格，即进程表（process table)。该表象包含进程状态的信息、它的程序计数器、堆栈指针、内存分配状况、所打开文件的状态、账号和调度信息，以及其他在进程由运行态转换到就绪态或阻塞时必须保存的信息，从而保证该进程能再次启动。

PCB中含由三部分：

进程管理：寄存器、程序计数器、程序状态字、堆栈指针、进程状态、优先级、调度参数、进程ID、父进程、进程组、信号、进程开始时间、使用的CPU时间、下次报警事件

存储管理：正文段指针，数据段指针、堆栈段指针

文件管理：根目录、工作目录、工作描述符、用户ID、组ID

[^中断发生后操作系统最底层的工作步骤]: s

1. 硬件压入堆栈程序计数器等
2. 硬件从中断向量装入新的程序计数器
3. 汇编语言过程保存寄存器
4. 汇编语言过程设置新的堆栈
5. C中断服务例程运行
6. 调度程序决定下一个将运行的进程
7. C过程返回值汇编
8. 汇编语言开始运行新的当前进程



## 线程

线程模型是基于：资源分组处理与执行分离开来。

进程：管理资源，其中有存放了程序正文和数据以及其他资源的地址空间。

线程：有一个程序计数器，用来记录接着执行那条指令，拥有寄存器，用来保存当前的工作变量，还拥有一个堆栈，用来记录执行历史，每一帧保存一个已调用但还未返回的过程。



### 线程的使用

需要线程的原因：在许多应用中同时发生多种活动，其中某些活动随着时间的进展会被阻塞。通过将这些应用分解程可以准并行运行的多个顺序线程，程序设计模型会变得简单。

优点：

1. 并行实体共享同一段地址空间和所有可用数据得能力
2. 线程附带得资源并不多，所以更容易创建，也更容易撤销
3. 若存在大量得计算和大量得I/O处理，拥有多个线程允许这些活动彼此重叠进行，从而加快应用执行的速度

### 实现的方法

1. 在用户空间中实现线程
2. 在内核中实现线程
3. 混合实现

### 进程间通信



